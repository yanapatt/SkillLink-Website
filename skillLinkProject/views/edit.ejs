<h1>Edit Post</h1>

<% if (post && post.length> 0) { %>
    <% post.forEach(p=> { %>
        <form action="/update/<%= p.postTitle %>" method="POST" enctype="multipart/form-data" id="edit-post-form">
            <label>Name:</label>
            <input type="text" name="postTitle" value="<%= p.postTitle %>" readonly>

            <label>Description:</label>
            <textarea name="postDesc" required><%= p.postDesc %></textarea>

            <input type="hidden" name="deleteImg" id="deleteImg" value="false" />

            <label>Current Image:</label>
            <% if (p.postImgUrl) { %>
                <div id="image-container">
                    <img src="<%= p.postImgUrl %>" alt="Post Image" width="150" id="post-image">
                    <button type="button" id="delete-image-btn" onclick="handleDeleteImage()">Delete Image</button>
                </div>
                <% } else { %>
                    <input type="file" name="postImgUrl" accept="image/*" id="image-upload">
                    <% } %>

                        <br><br>
                        <button type="submit">Update Post</button>
        </form>
        <br><a href="/">Back to Post List</a>
        <hr />
        <% }) %>
            <% } else { %>
                <h1>Post Not Found</h1>
                <a href="/">Back to Post List</a>
                <% } %>

                    <script>
                        function handleDeleteImage() {
                            const container = document.getElementById("image-container");
                            const deleteField = document.getElementById("deleteImg");

                            if (container && deleteField) {
                                container.remove();
                                deleteField.value = "true"; e

                                const fileInput = document.createElement("input");
                                fileInput.type = "file";
                                fileInput.name = "postImgUrl";
                                fileInput.accept = "image/*";
                                fileInput.id = "image-upload";

                                const form = document.getElementById("edit-post-form");
                                const submitButton = form.querySelector("button[type='submit']");
                                form.insertBefore(fileInput, submitButton);
                            }
                        }
                    </script>