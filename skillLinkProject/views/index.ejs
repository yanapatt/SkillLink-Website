<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/styles/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <title>Post Reviews</title>
</head>

<body>
  <!--navbar-->
  <div class="navbar-container">
    <div class="navbar-left">
      <a href="/" style="font-size: 20px">Skillink</a>
      <a href="#">Welcome <%= accUsername %>, Your Role is: <%= accRole %></a>
    </div>
    <a href="/logout">
      <button class="primary-outline-btn">Logout</button></a>
  </div>
  <div class="content">
    <div class="search-section">
      <!-- ✅ Form ครอบ Row 1 & Row 2 -->
      <form action="/search" method="POST">
        <div class="search-row">
          <h2>ค้นหาโพสต์ที่คุณต้องการได้เลย !</h2>
        </div>

        <!-- Row 1: Search Input -->
        <div class="search-row">
          <input type="text" name="value" placeholder="Search Posts" required />
        </div>

        <!-- Row 2: Select, Search, Clear -->
        <div class="search-row" style="padding-top: 5px;">
          <label for="searchType">Select Search Type:</label>
          <select name="action" id="searchType">
            <option value="byTitle">Search by Title</option>
            <option value="byAuthor">Search by Author</option>
          </select>
          <button type="submit" class="secondary-btn">Search</button>
          <a href="/clear-search"><button type="button" class="primary-btn">Clear</button></a>
        </div>
      </form>

      <!-- Row 3: Sort & MyPosts -->
      <div class="search-row">
        <form action="/search" method="POST" style="display: inline;">
          <input type="hidden" name="action" value="sortByRating" />
          <input type="hidden" name="value" value="<%= accId %>" />
          <button type="submit" class="primary-btn">Sort by Rating</button>
        </form>

        <form action="/search" method="POST" style="display: inline;">
          <input type="hidden" name="action" value="myPosts" />
          <input type="hidden" name="value" value="<%= accId %>" />
          <button type="submit" class="secondary-btn">Get My Posts</button>
        </form>
      </div>
    </div>

    <div class="main-content">
      <div class="left-content">
        <!-- Posts for non-admin users -->
        <% if (accRole !=='Admin' ) { %>
          <h2>ดูโพสต์</h2>
          <div class="sub-content">
            <% if (posts.length===0) { %>
              <p style="color: red; font-weight: bold; text-align: center;">Not Found!</p>
              <% } else { %>
                <ul>
                  <% posts.forEach(post=> { %>
                    <li>
                      <strong>
                        <%= post.postTitle %>
                      </strong>: <%= post.postDesc %>
                        by <%= post.authorName %> (Rating:⭐ <%= post.postRating || 0 %>)
                            <a href="/view/<%= post.postTitle %>">View</a>
                    </li>
                    <% }) %>
                </ul>
                <% } %>
          </div>
          <% } %>

            <!-- Admin Section -->
            <% if (accRole==='Admin' ) { %>
              <h2>จัดการโพสต์</h2>
              <div class="sub-content">
                <!-- Remove by Title -->
                <form id="remove-by-title-form" action="/remove-posts" method="POST">
                  <% if (posts.length===0) { %>
                    <p style="color: red; font-weight: bold; text-align: center;">Not Found!</p>
                    <% } else { %>
                      <ul>
                        <% posts.forEach(post=> { %>
                          <li>
                            <input type="checkbox" name="value" value="<%= post.postTitle %>" class="post-checkbox" />
                            <strong>
                              <%= post.postTitle %>
                            </strong>: <%= post.postDesc %>
                              by <%= post.authorName %> (Rating:⭐ <%= post.postRating || 0 %>)
                                  <a href="/view/<%= post.postTitle %>">View</a>
                          </li>
                          <% }) %>
                      </ul>
                      <% } %>
                        <input type="hidden" name="action" value="byTitle">
                </form>
              </div>

              <!-- Remove by Rating -->
              <form id="remove-by-rating-form" action="/remove-posts" method="POST">
                <label for="rating">Remove by Rating:</label>
                <input type="number" id="rating" name="value" min="0" max="5" step="0.1" value="0"
                  placeholder="Enter rating (0-5)" required>
                <input type="hidden" name="action" value="byRating">
                <button type="submit" class="primary-btn">Remove by Rating</button>
              </form>

              <div class="admin-actions">
                <!-- Remove Oldest -->
                <form action="/remove-first" method="POST">
                  <button type="submit" class="primary-btn">Remove Oldest Post</button>
                </form>

                <!-- Remove Newest -->
                <form action="/remove-last" method="POST">
                  <button type="submit" class="primary-btn">Remove Newest Post</button>
                </form>

                <!-- ปุ่ม Remove Selected Posts นอก sub-content -->
                <button type="submit" form="remove-by-title-form" id="remove-button" disabled
                  class="secondary-btn">Remove Selected
                  Posts</button>
              </div>
              <% } %>
      </div>
      <div class="right-content">
        <h3>#โพสต์สิ่งที่คุณต้องการได้เลย</h3>
        <form action="/add" method="POST" enctype="multipart/form-data">
          <% if (error) { %>
            <p id="error-message" style="color: red;">
              <%= error %>
            </p>
            <% } %>
              <input type="text" name="postTitle" placeholder="Post Title" required />
              <textarea name="postDesc" placeholder="Post Description" required></textarea>
              <input type="file" name="postImgUrl" accept="image/*" />
              <button type="submit" class="primary-outline-btn">Add Post</button>
        </form>
      </div>
    </div>
  </div>
</body>

</html>

<script src="/js/main.js"></script>